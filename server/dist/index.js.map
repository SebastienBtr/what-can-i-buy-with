{"version":3,"sources":["../src/index.js"],"names":["app","require","conf","dbParams","get","db","mysql","productController","use","req","res","next","setHeader","dbConnection","objConn","createConnection","host","user","password","database","connect","err","console","error","code","setTimeout","timeoutBeforeReconnection","info","connection","on","port","listen","log"],"mappings":";;AAAA,IAAIA,MAAMC,QAAQ,SAAR,GAAV;AACA,IAAIC,OAAOD,QAAQ,aAAR,CAAX;AACA,IAAIE,WAAWD,KAAKE,GAAL,CAAS,IAAT,CAAf;AACA,IAAIC,KAAKJ,QAAQ,SAAR,CAAT;AACA,IAAIK,QAAQL,QAAQ,OAAR,CAAZ;;AAEA,IAAIM,oBAAoBN,QAAQ,+BAAR,CAAxB;;AAEA;AACAD,IAAIQ,GAAJ,CAAS,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;;AAEzB;AACAD,QAAIE,SAAJ,CAAc,6BAAd,EAA6C,GAA7C;;AAEA;AACAF,QAAIE,SAAJ,CAAc,8BAAd,EAA8C,wCAA9C;;AAEA;AACAF,QAAIE,SAAJ,CAAc,8BAAd,EAA8C,+BAA9C;;AAEA;AACA;AACAF,QAAIE,SAAJ,CAAc,kCAAd,EAAkD,KAAlD;;AAEA;AACAD;AACH,CAjBD;;AAmBA;AACAX,IAAIQ,GAAJ,CAAQ,MAAR,EAAgB,CAACD,iBAAD,CAAhB;;AAEA,SAASM,YAAT,GAAwB;;AAEpB,QAAIC,UAAUR,MAAMS,gBAAN,CAAuB;AACjCC,cAAMb,SAASa,IADkB;AAEjCC,cAAMd,SAASc,IAFkB;AAGjCC,kBAAUf,SAASe,QAHc;AAIjCC,kBAAUhB,SAASgB;AAJc,KAAvB,CAAd;;AAOAL,YAAQM,OAAR,CAAiB,UAACC,GAAD,EAAS;;AAEtB,YAAIA,GAAJ,EAAS;AACLC,oBAAQC,KAAR,CAAc,8BAAd,EAA8CF,IAAIG,IAAlD;AACAC,uBAAWZ,YAAX,EAAyBV,SAASuB,yBAAlC,EAFK,CAEyD;AAEjE,SAJD,MAIO;AACHJ,oBAAQK,IAAR,CAAa,mBAAb;AACAtB,eAAGuB,UAAH,GAAgBd,OAAhB;AACH;AACJ,KAVD;;AAYAA,YAAQe,EAAR,CAAW,OAAX,EAAoB,UAACR,GAAD,EAAS;AACzB,YAAIA,IAAIG,IAAJ,KAAa,0BAAjB,EAA6C;AAAE;AAC3CX;AACH,SAFD,MAEO;AACH,kBAAMQ,GAAN;AACH;AACJ,KAND;AAOH;;AAEDR;;AAEA,IAAIiB,OAAO5B,KAAKE,GAAL,CAAS,QAAT,EAAmB0B,IAA9B;;AAEA9B,IAAI+B,MAAJ,CAAWD,IAAX,EAAiB,YAAM;AACnBR,YAAQU,GAAR,CAAY,2BAA2BF,IAAvC;AACH,CAFD","file":"index.js","sourcesContent":["let app = require('express')();\nlet conf = require('./config.js');\nlet dbParams = conf.get('db');\nlet db = require('./db.js');\nlet mysql = require('mysql');\n\nlet productController = require('./controllers/product.ctrl.js');\n\n// Add headers\napp.use( (req, res, next) => {\n\n    // Website you wish to allow to connect\n    res.setHeader('Access-Control-Allow-Origin', '*');\n\n    // Request methods you wish to allow\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');\n\n    // Request headers you wish to allow\n    res.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,content-type');\n\n    // Set to true if you need the website to include cookies in the requests sent\n    // to the API (e.g. in case you use sessions)\n    res.setHeader('Access-Control-Allow-Credentials', false);\n\n    // Pass to next layer of middleware\n    next();\n});\n\n// all of our routes will be prefixed with /api\napp.use('/api', [productController]);\n\nfunction dbConnection() {\n\n    let objConn = mysql.createConnection({\n        host: dbParams.host,\n        user: dbParams.user,\n        password: dbParams.password,\n        database: dbParams.database\n    });\n\n    objConn.connect( (err) => {\n\n        if (err) {\n            console.error('error when connecting to db:', err.code);\n            setTimeout(dbConnection, dbParams.timeoutBeforeReconnection); // We introduce a delay before attempting to reconnect\n\n        } else {\n            console.info('Connected to db !');\n            db.connection = objConn;\n        }\n    });\n\n    objConn.on('error', (err) => {\n        if (err.code === 'PROTOCOL_CONNECTION_LOST') { // Connection to the MySQL server is usually lost\n            dbConnection();\n        } else {\n            throw err;\n        }\n    });\n}\n\ndbConnection();\n\nlet port = conf.get('server').port;\n\napp.listen(port, () => {\n    console.log('app listening on port ' + port);\n});"]}